ТЕКУЩАЯ АРХИТЕКТУРА

Компоненты системы в виде монолита описаны в файле diagrams/context/AsIs.puml.
Состав системы:
- сервис обработки, монолит
- субд, единая
- нагревательные устройства
- датчики температуры

Функции пользователя:
- включать/выключать термопары
- задавать текущую температуру
- устанавливать целевую температуру
- опрашивать показания датчиков температуры

Свойства системы:
- данные от всех устройств и действия пользователя сохраняются в единственной субд
- данные обрабатываются монолитом в единственном экземпляре
- ввод в эксплуатацию новых объектов выполняется при выезде специалиста   
- обработка данных прекращается при отключении субд либо остановке монолита
- имеется ограничение на общее количество обслуживаемых объектов 

Недостатки системы монолита:
- при сбое в программе либо субд функционирование системы приостанавливается
- при потере данных обслуживание останавливается
- нельзя масштабировать систему с целью снятия ограничения на количество обслуживаемых объектов
- нельзя разбить систему на независимые компоненты
- нет единого ресурса для подключения к системе новых устройств или пользователей
- система не защищена от сетевых угроз
- нельзя диверсифицировать географию хранения данных с целью их защиты от потери


УМНЫЙ ДОМ
РАЗВИТИЕ СИСТЕМЫ

Микросервисная архитектура:
1. Обновление системы обслуживания дома
2. Старая система в виде монолита описана в файле diagrams/context/AsIs.puml
3. Новая система в виде микросервисов описана в файле diagrams/context/ToBe.puml

Умный дом состоит из компонентов:

1. Устройства:
- привод ворот
- привод камер
- термопары
- освещение

2. Датчики:
- температура
- камеры

3. Программное обеспечение:
- микросервисы
- базы данных
- шлюз
- шина

4. Объекты:
- дома
- периметр

5. Субъекты
- пользователи

Шлюз
Пробрасывает запросы и ответы на них:
1. От пользователей к сервису управления
2. От пользователей к устройствам
3. От датчиков к сервису телеметрии
4. Между микросервисами
5. К компонентам умного дома из сети интернет 

Микросервис управления:
1. Регистрирует справочные сведения о новых компонентах системы
2. Оповещает сервис телеметрии об изменениях в справочниках
3. Оказывает управляющие воздействия на устройства
4. Изменяет настройки датчиков
5. Описан в diagrams/component/Manager.puml
6. api описано в api/openapi3_0.yaml
7. модуль manager 

Микросервис телеметрии:
1. Регистрирует состояния датчиков
2. Регистрирует от сервиса управления изменения в справочниках 
3. Описан в diagrams/component/Telemetry.puml
4. api описано в api/openapi3_0.yaml
5. модуль telemetry

Интеграция микросервисов:
1. Сервис управления выталкивет новые справочники в api телеметрии
2. Синхронное restful api
3. api описано в api/openapi3_0.yaml

Базы данных:
1. Каждый микросервис имеет свой сервис баз данных
2. Структура бд разных микросервисов аналогична
3. Диаграмма сущностей бд описана в папке er

Развертывание:
1. файл docker-compose.yaml

Тесты:
1. Регистрация устройства в сервисе управления
Запрос:
curl -X POST -H 'Content-Type: application/json' \
-d '{"typeId":"1","houseId":"1","modulesId":"1","serialNumber":"CCFFXSXS-+t","name":"pup0-0"}' \
localhost:8181/devices
Результат:
- устройство записано в бд сервиса управления 
- устройство записано в бд сервиса телеметрии
2. Регистрация события в телеметрии
Запрос:
curl -X POST -H 'Content-Type: application/json' \
-d '{"stream": "DRF...67Y==", "temperature": ""}' \
localhost:8080/devices/3/telemetry/latest
Результат:
- видео событие записано в бд сервиса телеметрии
